name: Survey
description: An app which asks the user to fill out some questions.
defaultPage: Survey

layout:
  navigation: hidden
  enabledSettings:
    - languages

resources:
  answer:
    schema:
      type: object
      additionalProperties: false
      properties:
        triedAppsemble:
          type: boolean
        rating:
          type: number
          minimum: 1
          maximum: 5
        ratingFeedback:
          type: string
        notTriedReason:
          type: string
        anythingElse:
          type: string

security:
  guest:
    permissions:
      - $resource:answer:create

pages:
  - name: Survey
    type: flow
    actions:
      onFlowFinish:
        type: resource.create
        resource: answer
        onSuccess:
          type: link
          to: Finished
    steps:
      - name: Introduction
        blocks:
          - type: markdown
            version: 0.35.3
            layout: static
            parameters:
              content: { translate: introText }
          - type: button-list
            version: 0.35.3
            parameters:
              buttons:
                - label: { translate: start }
                  onClick: onStart
                  color: primary
            actions:
              onStart:
                type: flow.next

      - name: Familiarity
        blocks:
          - type: form
            version: 0.35.3
            actions:
              onSubmit:
                type: condition
                if: { prop: triedAppsemble }
                then:
                  type: flow.to
                  step: Appsemble Ratings
                else:
                  type: flow.to
                  step: Appsemble Feedback
              onPrevious:
                type: flow.back
            parameters:
              previous: true
              fields:
                - type: radio
                  name: triedAppsemble
                  label: { translate: triedAppsemble }
                  requirements: [{ required: true }]
                  options:
                    - value: true
                      label: { translate: yes }
                    - value: false
                      label: { translate: no }

      - name: Appsemble Ratings
        blocks:
          - type: form
            version: 0.35.3
            actions:
              onSubmit:
                type: flow.to
                step: Anything Else
              onPrevious:
                type: flow.to
                step: Familiarity
            parameters:
              previous: true
              fields:
                - type: radio
                  name: rating
                  label: { translate: appsembleRating }
                  requirements: [{ required: true }]
                  options:
                    - value: 1
                    - value: 2
                    - value: 3
                    - value: 4
                    - value: 5
                - type: string
                  name: ratingFeedback
                  multiline: true
                  label: { translate: betterExperience }

      - name: Appsemble Feedback
        blocks:
          - type: form
            version: 0.35.3
            actions:
              onSubmit:
                type: flow.to
                step: Anything Else
              onPrevious:
                type: flow.to
                step: Familiarity
            parameters:
              previous: true
              fields:
                - type: string
                  name: notTriedReason
                  multiline: true
                  label: { translate: notTriedReason }
                  requirements: [{ required: true }]

      - name: Anything Else
        blocks:
          - type: form
            version: 0.35.3
            actions:
              onSubmit:
                type: flow.finish
              onPrevious:
                type: condition
                if:
                  prop: notTriedReason
                then:
                  type: flow.to
                  step: Appsemble Feedback
                else:
                  type: flow.to
                  step: Familiarity
            parameters:
              previous: true
              fields:
                - type: string
                  name: anythingElse
                  label: { translate: anythingElse }

  - name: Finished
    blocks:
      - type: markdown
        version: 0.35.3
        layout: static
        parameters:
          content:
            string.format:
              messageId: finished
              values:
                appId: { app: id }
      - type: button-list
        version: 0.35.3
        parameters:
          buttons:
            - label: { translate: backToHome }
              onClick: home
              color: primary
        actions:
          home:
            type: link
            to: Survey
